---
title: DST服务器
date: 2025-07-16 00:45:59
updated: 2025-10-06 02:41:11
categories:
  - [For Fun]
tags:
permalink: dst服务器/
---

参考：
[萌新亲测白嫖饥荒云服务器搭建成功全流程_哔哩哔哩bilibili_饥荒联机版](https://www.bilibili.com/video/BV1HkY8eaEpH?spm_id_from=333.788.videopod.sections&vd_source=d97d82191b995e0ba21c3438b8cf6adb)
[饥荒联机版服务器搭建Linux（Ubuntu20.04）及常见报错和模组启用2023.5（超详细） - 哔哩哔哩](https://www.bilibili.com/opus/798802812813180931)
[搭建饥荒服务器（2024.3更新） - 知乎](https://zhuanlan.zhihu.com/p/625645476
[在你的 Linux 服务器上安装 SteamCMD 并搭建游戏服务器 · 瞳のBlog](https://www.hetong-re4per.com/posts/install-steamcmd-on-your-linux-server-and-setup-game-server/)
知乎那篇最好用。
时间有点久远了，简单记一下，主要有这么几步：
### 1.安装steamcmd
直接装：
```bash
sudo apt install steamcmd
```

启动：
```bash
steamcmd
```

装不上就先装依赖：
```bash
sudo add-apt-repository multiverse
sudo dpkg –add-architecture i386
sudo apt update
sudo apt install lib32gcc-s1 libcurl4-gnutls-dev:i386 lib32stdc++6 lib32z1 -y
```

还可以下载解压之后启动：
```bash
wget https://steamcdn-a.akamaihd.net/client/installer/steamcmd_linux.tar.gz
tar -xvzf steamcmd_linux.tar.gz
./steamcmd.sh
```

### 2.安装游戏服务器
在[SteamDB](https://steamdb.info/)找到饥荒的APP ID
安装
```bash
steam> force_install_dir ../dontstarvetogether_dedicated_server
steam> login anonymous
steam> app_update 343050 validate
steam> quit
```

### 3.建一个服务器存档
1. 在windows上创建好地图，这会在电脑上生成一个存档文件，目录大概为：`C://User/xxx/文档/klei/DoNotStarveTogether`
2. 访问[Klei Account](https://accounts.klei.com/account/game/servers?game=DontStarveTogether)建一个服务器token，将token复制到`cluster_token.txt`文件中，放在存档目录下。
3. 记录[Klei Account](https://accounts.klei.com/account/info)中的Klei ID，复制到`adminlist.txt`文件中，给自己加管理员权限。
4. 服务器的名称的名称和密码在`.klei/DoNotStarveTogether/Cluster_1/cluster.ini` 文件中
5. 整个文件目录上传到服务器上，我上传的位置是：`/home/ubuntu/.klei/DoNotStarveTogether/Cluster_1/`

### 4.模组与启动脚本
服务器目录下的mod文件是确定要下载哪些mod：
```bash
cd /dontstarvetogether_dedicated_server/mods
vim dedicated_server_mods_setup.lua
```

存档中启用的mod在这里`.klei/DoNotStarveTogether/Cluster_1/Master/modoverride.lua`查看，这是地面的，记得还有洞穴。

我的启动脚本`DST.sh`在用户目录下，内容是这样的：
```text `!/bin/bash`

steamcmd_dir="/usr/games"
install_dir="$HOME/Steam/steamapps/common/Don't Starve Together Dedicated Server"
cluster_name="Cluster_1"
dontstarve_dir="$HOME/.klei/DoNotStarveTogether"

function fail() {
    echo Error: "$@" >&2
    exit 1
}

function check_for_file() { 
    if [ ! -e "$1" ]; then
        fail "Missing file: $1"
    fi
}

cd "$steamcmd_dir" || fail "Missing $steamcmd_dir directory!"
check_for_file "steamcmd"
check_for_file "$dontstarve_dir/$cluster_name/cluster.ini"
check_for_file "$dontstarve_dir/$cluster_name/cluster_token.txt"
check_for_file "$dontstarve_dir/$cluster_name/Master/server.ini"
check_for_file "$dontstarve_dir/$cluster_name/Caves/server.ini"
check_for_file "$install_dir/bin"
cd "$install_dir/bin" || fail
run_shared=(./dontstarve_dedicated_server_nullrenderer)
run_shared+=(-console)
run_shared+=(-cluster "$cluster_name")
run_shared+=(-monitor_parent_process $$)
run_shared+=(-shard)
"${run_shared[@]}" Caves | sed 's/^/Caves: /' &
"${run_shared[@]}" Master | sed 's/^/Master: /'
```

加个权限：
```bash
sudo chmod u+x DST.sh
```

### 5.开放端口
在租用服务器的管理界面安全组开放端口。具体需要开放的端口可以查看存档文件夹下的这几个文件：
```text
# 饥荒端口，UDP协议
~/.klei/DoNotStarveTogether/Cluster_1/cluster.ini 中的 master_port。
~/.klei/DoNotStarveTogether/Cluster_1/Master/server.ini 中的 server_port。
~/.klei/DoNotStarveTogether/Cluster_1/Caves/server.ini 中的 server_port
# steam端口，TCP+UDP协议
~/.klei/DoNotStarveTogether/Cluster_1/Caves/server.ini 中的 master_server_port、authentication_port
```
### 6.运行与后续
带日志输出的运行：
```bash
nohup ./boot.sh>root.log 2>&1 &
```
据说可能会因为缺少依赖报错。

运行成功如下：
![DST.png](/images/DST.png)

关闭就是找到PID然后kill掉：
```bash
ps -ef | grep don
kill 服务器pid
```