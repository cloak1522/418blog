---
title: mubu的毕业设计工作日志
date: 2025-06-01 10:34:58
updated: 2024-12-04 16:50:42
categories:
  - [本科毕业设计]
tags:
permalink: mubu的毕业设计工作日志/
---

## 之前的工作：

### 香橙派可以通过串口发送指令

- 基于wringpi库，将wringop-python的例程修改得到
- 串口3，香橙派设备号ttyS3
- 写好了程序serial_test.py放在root文件夹下，通过python3 serial_test.py --device "/dev/ttyS3"运行
- 通过vim serial_test.py修改
- 蓝牙串口可以接收到正确数据
### 串口指令控制小车运行
- 蓝牙串口从上位机发送指令可以控制车的运动
- 具体指令如下：
- 接收11位数据：
- 1：帧头：0x7B
- 2&3：预留位（0x00）
- 4&5：x轴目标速度
- 6&7：y轴目标速度
- 8&9：z轴目标速度
- 10：校验位 0与前9位分别按位异或
- 11：帧尾：0x7D
### 安装PySimpleGUI、OpenCV等库
- 安装出现问题后，下载了python3.9版本，pip的位置也改到了python3.9下
- 好像用python-tk解决了tkinker的问题，检查了一下两个版本python的库（3.7和3.9）
- python默认2.7  python3默认3.7，发现该用的库装好了而且3.9版本用不到，将pip通过更新的方式换回了3.7下
### 香橙派连接摄像头的测试
- 通过motion测试的摄像头可以使用（插在上面那个usb口）。但是后续发现motion开机运行会影响程序中对摄像头的调用，故通过sudo service motion stop 关闭服务。最后修改了配置文件（路径/etc/default/motion）start_motion_daemon=no，不允许后台运行。
- 使用OpenCV的python库在程序中调用摄像头，cv2.VideoCapture(1).isOpened()测试能正确开启。
- 编写了pic.py程序（root文件夹下），保存一张图片到root文件夹。
## 4.7一周的工作：

### 交互界面

- 使用ssh远程登录无法弹出窗口。安装xming。[Xming X Server for Windows - 官方网站](http://www.straightrunning.com/XmingNotes/)
- sshd_config配置文件注意X11Forwrding yes。sudo vim /etc/ssh/sshd_config
- xming安装目录X0.hosts加入香橙派ip地址（白名单），直接写在下面就行。
- 勾选no access control
![xming界面.png](/images/xming界面.png)

- 命令行输入一句指令export DISPLAY=192.168.2.3:0.0（上位机ip地址），即可正常弹出窗口，用xclock和PySimpleGUI测试没问题。
![xserver工具测试.png](/images/xserver工具测试.png)

### 串口控制小车

- 用示波器测了上位机发串口指令和香橙派发串口指令的波形，基本一样，只是电压有一点差别，但是感觉不应该有影响。
## 4.14一周的工作：

### 初步在集群上运行程序

- 集群主机的ip是固定的，登录主机运行即可
- source ~/pytest/bin/activate 进入虚拟环境后再运行程序
- 卸载了原有的opencv包，用香橙派文档里的apt指令重装了一个
- 不太清楚虚拟环境模块是否用的是已安装模块，有待学习
### 编写了人机交互界面的算法，但是比较卡

- 基于PySimpleGUI编写，可以运行，但是还得改进不少
- 目前是读取图片-第一帧画框-目标跟踪-每张图片画框-打印在界面上并刷新
### hc08蓝牙串口买到了，仍无法控制

- 怀疑是stm32串口电平无法被拉低导致
- 基本排除了串口通信停止位等问题
## 4.19一周的工作：

### 小车实现通过串口控制运动

- 无线串口换成了逐飞的，最终实现
## 6.2之后的工作：

- 用单个香橙派把车跑起来，录个视频混一下
### 先配置好虚拟环境

#### 安装 virtualenv和virtualenvwrapper

- pip install virtualenv -i https://mirrors.aliyun.com/pypi/simple/
- pip install virtualenvwrapper -i https://mirrors.aliyun.com/pypi/simple/
-   // 安装完成后使用命令进行查看是否安装
- pip list
#### 修改配置文件

- 查询地址
- find / -name "virtualenvwrapper.sh"
- find / -name "virtualenv"
- 修改
![virtualenv配置文件修改.png](/images/virtualenv配置文件修改.png)

#### 执行source ~/.bashrc-- 有时候重启虚拟机时创建不了虚拟机，也用这个命令再执行一次即可
#### 常用命令
![virtualenv常用指令.png](/images/virtualenv常用指令.png)
#### 关于报错

![virtualenv报错.png](/images/virtualenv报错.png)

#### 查看python安装位置的方法
- whereis python
- which python当前的
- 进入python环境，import sys print(sys.path)
### 在虚拟环境中配置相关库

#### wiringpi库
- wiringOP已经安装，注意在虚拟环境运行加上sudo
#### opencv-python
- pip install opencv-python
- 测试摄像头
![opencv摄像头测试.png](/images/opencv摄像头测试.png)

#### siamLAT
- 所需库如下：
![siamLAT所需库.png](/images/siamLAT所需库.png)
- lmdb torch torchvision fire opencv-python panda sklearn tensorboardX visdom tqdm matplotlib got10k IPython
- 用track1video.py测试
#### nicegui
- 直接pip安装
- 不带摄像头画面的界面显示正常
- 带上摄像头画面之后
	不带sudo摄像头打不开 带上sudo cv2找不到
- 发现是任务量过多的问题，后续进一步处理
### 整合工作

- 把串口发送的文件变为一个模块my_serial并测试成功，可以正常使用
- 发现wiringpi库只能用按照香橙派说明文档安装的那个
![wiringpi.png](/images/wiringpi.png)
- 虚拟环境中安装要去掉sudo
- nicegui显示视频失败，还是应该换回PySimpleGUI，先把控制算法编完再说