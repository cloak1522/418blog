---
title: 摄像头相关
date: 2025-06-01 10:34:58
updated: 2025-03-05 20:06:05
categories:
  - [服务器&嵌入式平台操作, 嵌入式&硬件]
tags:
permalink: 摄像头相关/
---

## 树莓派官方CMI摄像头——基础配置

> [!NOTE] 操作环境
> 树莓派4 官方系统Raspberry Pi OS Lite版
> Linux raspberrypi 6.1.0-rpi7-rpi-v8 `1` SMP PREEMPT Debian 1:6.1.63-1+rpt1 (2023-11-24) aarch64
> Python 3.11.2
> 摄像头感光芯片OV5647
> 
### 1.驱动
当前版本的CMI摄像头官方驱动是libcamera
### 2.Python所需package
来源于：[解决树莓派原装libcamera(csi)摄像头无法通过opencv读取数据的问题_libcamera opencv-CSDN博客](https://blog.csdn.net/zhangmou_9008/article/details/134047114)

1. 首先创建虚拟环境
来源于：[[BUG] python3-libcamera not available in venv · Issue `341` · raspberrypi/picamera2 · GitHub](https://github.com/raspberrypi/picamera2/issues/341)
[Python 使虚拟环境集成特定全局包|极客教程 (geek-docs.com)](https://geek-docs.com/python/python-ask-answer/71_python_make_virtualenv_inherit_specific_packages_from_your_global_sitepackages.html)

```bash
python -m venv --system-site-packages myenv
```
注意指定`--system-site-packages`选项来让虚拟环境继承全局site-packages，便于在虚拟环境中使用`libcamera`包。（由于libcamera目前无法在虚拟环境中安装和使用）

接下来进入虚拟环境
```bash
source myenv/bin/activate
```

2. 安装OpenCV
```bash
pip install opencv-python
pip install opencv-python-headless
```

3. 安装picamera2
来源于：[GitHub - raspberrypi/picamera2: New libcamera based python library](https://github.com/raspberrypi/picamera2)
[安装python-prctl报错_you need to install libcap development headers to -CSDN博客](https://blog.csdn.net/xyxyxxxy/article/details/108729329)
[You need to install libcap development headers to build this module · Issue `18` · facebookresearch/vilbert-multi-task · GitHub](https://github.com/facebookresearch/vilbert-multi-task/issues/18)
[Welcome to python-prctl’s documentation! — python-prctl 1.6.1 documentation (pythonhosted.org)](https://pythonhosted.org/python-prctl/)
```bash
sudo apt install -y python3-libcamera python3-kms++
sudo apt install -y python3-pyqt5 python3-prctl libatlas-base-dev ffmpeg python3-pip
pip3 install numpy --upgrade
pip3 install picamera2[gui]
```

对于最后一步可能会出现的错误`You need to install libcap development headers to build this module` 解决方法如下：
```bash
apt-get update
apt-get install build-essential libcap-dev
```

### 3.测试程序
```bash
from picamera2 import Picamera2  
import cv2  
import time  
   `初始化`  
picam2 = Picamera2()    `创建摄像头对象开启摄像头，只能创建一次`  
picam2.start()  `开启摄像头，无需重复开启`  
time.sleep(1)  
   `抓拍`  
array = picam2.capture_array("main")    `捕获一帧相机数据，输出为numpy.ndarray类型，与opencv无缝连接`  
  
cv2.imwrite('test.png',array)
```

### 4.其他可行的方法
在系统环境下安装：
```bash
sudo apt install -y python3-picamera2
```

之后直接创建一个继承全局包的虚拟环境。
OpenCV的安装方法不变。