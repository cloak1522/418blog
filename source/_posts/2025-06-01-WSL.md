---
title: WSL
date: 2025-06-01 10:34:58
updated: 2025-03-01 09:47:16
categories:
  - [服务器&嵌入式平台操作, 基础配置]
tags:
permalink: wsl/
---

## 安装及基础教程
$Last Edited：2024.12.25/09:22$
___
### 安装
直接看微软官方：[安装 WSL | Microsoft Learn](https://learn.microsoft.com/zh-cn/windows/wsl/install)

### 修改密码
$Last Edited：2025.02.24/15:10$
___

在powershell中输入：
```bash
wsl.exe -d Ubuntu-22.04 --user root
```

输入:
```bash
passwd username
```
修改用户密码，`username`为需要修改的用户。

### 开启SSH
$Last Edited：2025.02.24/15:10$
___

参考：[Windows开启（WSL）Linux子系统并远程连接SSH_wsl ssh-CSDN博客](https://blog.csdn.net/tzsm11/article/details/137093575)
在windterm上直接打开wsl的终端时，文件管理器并不会随之更新，不太方便，而使用SSH连接本地的wsl终端就可以解决这个问题。

首先安装openssh：
```bash
sudo apt install openssh-server
```

编辑配置文件：
```bash
sudo nano /etc/ssh/sshd_config
```

主要修改以下几项：
```text
Port 2223
PermitRootLogin prohibit-password
PubkeyAuthentication yes
```
注意端口要选空闲的，后面两项是允许root用户登录的，不需要可以不加。

重启SSH服务：
```bash
sudo service ssh restart
```

使用`ip addr`查看ip地址
```text
amadeus@P2310101656:~$ ip addr
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet 10.255.255.254/32 brd 10.255.255.254 scope global lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether 00:15:5d:81:d0:f8 brd ff:ff:ff:ff:ff:ff
    inet 172.23.162.102/20 brd 172.23.175.255 scope global eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::215:5dff:fe81:d0f8/64 scope link 
       valid_lft forever preferred_lft forever
```
可以看到ip地址为172.23.162.102。

### 远程桌面（Unbuntu22.04）
$Last Edited：2025.02.25/10:36$
___

参考：[【24年9月亲测可用】Windows11-WSL2-Ubuntu22.04-可视化桌面安装教程（附带CUDA，cuDNN）_wsl2桌面环境-CSDN博客](https://blog.csdn.net/Leo9344/article/details/141965910)
[Ubuntu 22.04远程桌面xrdp打开黑屏_ubuntu xrdp 黑屏-CSDN博客](https://blog.csdn.net/taxuebufeng/article/details/141063474)

- 安装依赖
```bash
sudo apt-mark hold acpid acpi-support
```

- 安装桌面环境
```bash
sudo apt-get install ubuntu-desktop
```

- 安装远程控制软件
```bash
sudo apt-get install xrdp
```

- 修改端口
```bash
sudo sed -i 's/3389/3390/g' /etc/xrdp/xrdp.ini
```

- 配置session，防止远程桌面输入密码后闪退。（这个不加确实会闪退）
```bash
echo "gnome-session" > ~/.xsession
```

- 修改配置文件，防止远程桌面连接后黑屏。（这个不加也会闪退）
```bash
sudo vim /etc/xrdp/startwm.sh
```

新增几行：
```text
unset DBUS_SESSION_BUS_ADDRESS # 新增 
unset XDG_RUNTIME_DIR # 新增

gnome-session # 新增
```
前两行是清理环境变量，放在开头。
最后一行用于启动gnome桌面环境，放在结尾。
其中`gnome-session`是博客里说要加的，但是试过不加也行。
测试发现是因为`~/.xsession`有`gnome-session`了，实际上`~/.xsession`和`/etc/xrdp/startwm.sh`其中一个有`gnome-session`就行。

- 重启服务并查看服务状态
```bash
sudo systemctl restart xrdp
sudo systemctl status xrdp
```

- 远程桌面利用windows自带的`mstsc`即可。
按`Win+R`，输入`mstsc`打开，计算机输入`localhost:3390`（刚才设置的端口），后面登录的用户名和密码是Ubuntu系统设置的用户名和密码。