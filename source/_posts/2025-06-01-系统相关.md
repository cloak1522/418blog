---
title: 系统相关
date: 2025-06-01 10:34:58
updated: 2025-01-10 22:50:54
categories:
  - [服务器&嵌入式平台操作, 基础配置]
tags:
permalink: 系统相关/
---

## 树莓派拷贝系统到SD卡
参考：[超简单的树莓派SD卡扩容方案，将树莓派16GB的SD卡克隆到64GB的SD卡-CSDN博客](https://blog.csdn.net/zhuoyuedelan/article/details/120684117?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-1-120684117-blog-110260864.235^v43^pc_blog_bottom_relevance_base3&spm=1001.2101.3001.4242.2&utm_relevant_index=2)
[树莓派 拷贝系统到新SD卡_树莓派的sd卡可不可以互换-CSDN博客](https://blog.csdn.net/weixin_43444901/article/details/110260864)
[制作SD卡备份镜像以及还原_sd卡自动还原-CSDN博客](https://blog.csdn.net/sinat_33909696/article/details/116430895)
[制作树苺派/香橙派(orangepi) SD卡备份镜像_树苺派系统备份与还原_orange pi 香橙派emmc系统备份方法-CSDN博客](https://blog.csdn.net/Running_free/article/details/103028160)

1. 格式化SD卡，选择FAT格式，备份用的SD卡容量不小于系统SD卡。
2. SD卡插到读卡器上，再连接到树莓派USB口。
3. list block devices，查看系统磁盘使用情况：
```bash
lsblk
```

该指令常用参数如下：
![lsblk参数.png](/images/lsblk参数.png)
如果输入：
```bash
df -h
```

没有发现这个SD卡，说明没有挂载，可以进行下一步操作。
如果发现的话，需要先卸载：
```bash
sudo umount /dev/sda1
```

格式化：
```bash
sudo mkfs.vfat /dev/sda1 -I
```

4. **拷贝**
输入指令：
```bash
sudo dd if=/dev/mmcblk0  of=/dev/sda  bs=4M status=progress
```
`bs=4M` 指定了块大小为4MB，`status=progress` 会显示克隆进度

5. **安全移除外部存储设备**：在测试启动之前，使用以下命令安全移除外部存储设备。
```bash
sudo eject /dev/sda
```

## 香橙派拷贝系统到SD卡

> [!NOTE] 操作环境
> 香橙派4-lts Orange Pi 3.0.6 Buster with Linux 4.4.179-rk3399

参考：[【香橙派】如何备份与烧写香橙派的系统_香橙派5 如何烧录-CSDN博客](https://blog.csdn.net/weixin_43326110/article/details/136852823)
[香橙派迁移系统到新的 SD 卡 | canhetingsky | Blog](https://blog.canheting.cn/posts/7a51f279/)
[制作树苺派/香橙派(orangepi) SD卡备份镜像_树苺派系统备份与还原_orange pi 香橙派emmc系统备份方法-CSDN博客](https://blog.csdn.net/Running_free/article/details/103028160)

1. SD卡插入读卡器，再连接到香橙派USB接口
2. 给SD卡分区扩容
输入：
```bash
lsblk
```
显示：
```text
root@orangepi4-lts:~# lsblk 
NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT 
sda 8:0 1 29.7G 0 disk 
└─sda1 8:1 1 1.6G 0 part 
mmcblk0 179:0 0 29.7G 0 disk 
└─mmcblk0p1 179:1 0 29.4G 0 part / 
zram0 253:0 0 1.9G 0 disk [SWAP] 
zram1 253:1 0 50M 0 disk /var/log
```
sda1只有1.6G，这时需要给sda扩容（如果空间够用就不用了，直接跳到步骤4），输入：
```bash
sudo fdisk /dev/sda
```

在fdisk中根据指令操作，先输入==d==删除旧分区，再输入==n==创建新分区，将所有可用空间都放到分区sda1里
3. 格式化分区
输入：
```bash
sudo mkfs.vfat /dev/sda1 -I
```
4. 挂载分区
在用户目录下新建一个sdcard目录：
```bash
mkdir sdcard
```

挂载到sda1下：
```bash
sudo mount /dev/sda1 ./sdcard/
```

5. 备份系统
==cd==进入sdcard目录。
开始备份系统：
```bash
sudo dd if=/dev/mmcblk0 conv=sync,noerror bs=4M status=progress | gzip -c > ./p3img.img.gz
```

结束
```text
31906070528 bytes (32 GB, 30 GiB) copied, 2780 s, 11.5 MB/s
7609+1 records in
7610+0 records out
31918653440 bytes (32 GB, 30 GiB) copied, 2780.87 s, 11.5 MB/s
```

6. 取消挂载拔出SD卡
```bash
sudo mount /dev/sda1 ./sdcard/
sudo eject /dev/sda
```

## 香橙派还原拷贝的系统

> [!NOTE] 操作环境
> 香橙派4-lts Orange Pi 3.0.6 Buster with Linux 4.4.179-rk3399

参考：OrangePi_4_LTS_用户手册
1. 这里准备的SD卡和制作系统镜像的SD卡大小一样。首先格式化SD卡。

2. 使用Win32Disklmager烧录备份的系统镜像.img文件，最后可能提示镜像大小比SD卡容量大，但系统镜像后面大部分都是空的，无视就好。

3. 将SD卡插入香橙派开机。由于镜像是从其他机器拷贝的，所以现有网络连接的网卡MAC地址对应不上，在这个情况下，系统会生成一个新的网络连接。可以通过以下指令查看。
```bash
ifconfig eth0
```

4. 接下来重新配置网络连接就可以，比如静态ip，DNS等，然后重启网络连接服务。可以通过指令配置。
```bash
nmtui
```